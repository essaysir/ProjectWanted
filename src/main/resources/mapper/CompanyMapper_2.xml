<?xml version="1.0" encoding="UTF-8"?>
<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<!--  mapper 의 namespace(네임스페이스)가 중복되면, 작동하지 않는다. -->
<mapper namespace="com.spring.wanted.ProjectWanted.company.mapper.InterCompanyMapper_2">
	
	<!-- job_select에필요한 값 가져오기	 -->
	<resultMap type="HashMap" id="getJobList_Map">
		<result property="job_code" 	column="job_code" javaType="String" />
		<result property="job_name" 	column="job_name" javaType="String" />
	</resultMap>
	<select id="getJobList" resultMap="getJobList_Map">
		select job_code, job_name 
		from tbl_job
	</select>
	
	<!-- job_select에 따라 해당되는 duty_select 가져오기 -->
	<resultMap type="HashMap" id="getDutyList_Map">
		<result property="duty_code" 	column="duty_code" javaType="String" />
		<result property="duty_name" 	column="duty_name" javaType="String" />
	</resultMap>
	<select id="getDutyList" parameterType="String" resultMap="getDutyList_Map">
		select duty_code, duty_name
		from tbl_duty
		where fk_job_code = ${jobCode}
	</select>
	
	<!-- TBL_POST에 등록하기 -->
	<insert id="insertRecruit" parameterType="com.spring.wanted.ProjectWanted.post.model.PostVO">
		<if test='image == null'>
		insert into tbl_post(POST_CODE, FK_COMPANY_ID, FK_DUTY_CODE, CAREER, SUBJECT, INFO, CREATEDAY, SALARY, MAINDUTY, QUALITY, DEADLINE, VIEWCOUNT, PAY_STATUS) 
		values(SEQ_POST.nextval, 'test_wanted', #{fk_duty_code}, #{career}, #{subject}, #{info}, #{createday}, #{salary}, #{mainduty}, #{quality}, #{deadline}, default, 0)
		</if>
		<if test='image != null'>
			insert into tbl_post(POST_CODE, FK_COMPANY_ID, FK_DUTY_CODE, CAREER, SUBJECT, INFO, IMAGE, CREATEDAY, SALARY, MAINDUTY, QUALITY, DEADLINE, VIEWCOUNT, PAY_STATUS) 
		values(SEQ_POST.nextval, 'test_wanted', #{fk_duty_code}, #{career}, #{subject}, #{info}, #{image}, #{createday}, #{salary}, #{mainduty}, #{quality}, #{deadline}, default, 0)
		</if>
	</insert>
	
	<select id="getTotalPost" parameterType="String" resultType="int">
		select count(*)
		from tbl_post
		where fk_company_id = #{id}
	</select>
	
	<resultMap type="HashMap" id="getPost_Map">
		<result property="post_code" 	column="post_code" 	javaType="String" />
		<result property="subject" 		column="subject" 	javaType="String" />
		<result property="createday" 	column="createday" 	javaType="String" />
		<result property="deadline" 	column="deadline" 	javaType="String" />
		<result property="pay_status" 	column="pay_status" javaType="String" />
		<result property="dateDiff" 	column="dateDiff" 	javaType="String" />
		<result property="job_name" 	column="job_name" 	javaType="String" />
	</resultMap>
	<select id="getPost" parameterType="String" resultMap="getPost_Map">
		select post_code, subject, createday, deadline, pay_status, DateDiff, job_name
		from
		(
		    select row_number() over(order by post_code desc) AS RNO, post_code, subject, to_char(createday,'yy/mm/dd') AS createday, to_char(deadline,'yy/mm/dd') AS deadline, pay_status
		            ,TRUNC(TO_DATE(deadline, 'YY/MM/DD')-SYSDATE + 1 ) AS DateDiff, job_name
		    from tbl_post P
		    JOIN tbl_duty D
		    on p.fk_duty_code = D.duty_code
		    JOIN tbl_job J
		    on D.fk_job_code = J.job_code
		) V
		where RNO between #{start} and #{end}
	</select>

</mapper>